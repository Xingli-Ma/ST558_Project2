---
title: "Project 2"
author: "Nermin Bibic"
date: "7/11/2021"
output:
  github_document:
    toc: yes
    toc_depth: 3
params:
  day: 1
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE, message = FALSE, warning = FALSE, error = TRUE)
```

```{r, echo = FALSE}
library(tidyverse)
library(knitr)
library(caret)
```

## Read Data and Split Into Training & Test Sets

```{r}
# Read and clean data
dayData <- read_csv("day.csv")
dayData <- filter(dayData, weekday == params$day)
dayData <- select(dayData, -c(instant, weekday))
dayData$dteday = as.Date(dayData$dteday, format = "%Y-%m-%d")

# Split data to train and test sets
set.seed(1)
dayIndex <- createDataPartition(dayData$cnt, p = 0.7, list = FALSE)
dayTrain <- dayData[dayIndex, ]
dayTest <- dayData[-dayIndex, ]

# Convert categorical variables to factors
cols <- c("season", "yr", "mnth", "holiday", "workingday", "weathersit")
dayTrain[cols] <- lapply(dayTrain[cols], factor)
dayTest[cols] <- lapply(dayTest[cols], factor)
```

## Summarizations

### Contingency Table Comparing Number of Users By Season

```{r}
dayTrainCopy <- dayTrain
dayTrainCopy$cntRange <- cut(dayTrainCopy$cnt, c(0, 2000, 4000, 6000))
levels(dayTrainCopy$cntRange) = c("<2000", "2001-4000", "4001-6000", ">6000")

levels(dayTrainCopy$season) <- list("Winter" = 1,
                                    "Spring" = 2,
                                    "Summer" = 3,
                                    "Fall" = 4)

twoWayTab <- table(dayTrainCopy$season,
                   dayTrainCopy$cntRange)
kable(twoWayTab, caption = 'Season and Total Number of Users')
```



## Predictive Modeling

Provide a short but thorough explanation of the idea of a linear regression model.

### Linear Regression With Main Effects & 1st Order Interactions

```{r}

```

### Fit a random forest model on training dataset

Here we are fitting a random forest model for the train set. We standardize the variables by centering and scaling using the preProcess argument, and apply repeated cross validation. The final value used for the model was mtry = 26, where Rsquared equals 0.9507297.

```{r}
# Set up fold number (10) for the cross validation and the repeated times (5) of the whole CV 
trctrl <- trainControl(method = "repeatedcv", number = 10, repeats = 5)
# Set seed for reproducible
set.seed(123)
# Fit the random forest model with cnt as response and all other variables as
# predictors on training set
rfFit <- train(cnt ~ ., data = dayTrain,
               method = "rf",
               preProcess = c("center", "scale"),
               trControl = trctrl)
rfFit
```



